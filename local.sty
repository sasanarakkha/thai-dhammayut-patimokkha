\ProvidesPackage{local}

\usepackage{pdfcomment}

\newcommand{\todo}[1]{\pdfcomment[icon=Note]{#1}}

\newcommand{\margintodo}[1]{\pdfmargincomment[icon=Note]{#1}}

\usepackage{ltablex}

\newlength\leaderIndent
\setlength{\leaderIndent}{1.5em}

\newlength\packedLeaderIndent
\setlength{\packedLeaderIndent}{1.1em}

\setlength{\vgap}{1.5em}
\setlength{\vindent}{\leaderIndent}
\setlength{\vleftmargin}{2em}

\setlength{\parskip}{5pt}
\setlength{\parindent}{0pt}

\renewenvironment{center}%
{\list{}{%
    \parskip -10pt%
    \topsep -4pt%
    \listparindent 0em%
    \itemindent    0pt%
    \leftmargin    0pt %\leaderIndent%
    \rightmargin   0pt%
    \parsep        0pt}
  \fontsize{12.5}{18}\selectfont
  \item[] \centering}%
{\endlist}

\newenvironment{intro}%
{\list{}{%
    \parskip 0pt%
    \topsep -12pt%
    \listparindent 0em%
    \itemindent    0pt%
    \leftmargin    0pt %\leaderIndent%
    \rightmargin   0pt%
    \parsep        0pt}
  \fontsize{12.5}{18}\selectfont
  \item[] \centering}%
{\endlist}

\newenvironment{outro}%
{\list{}{%
    \parskip 0pt%
    \topsep 10pt%
    \listparindent 0em%
    \itemindent    0pt%
    \leftmargin    0.5cm %\leaderIndent%
    \rightmargin   0.5cm%
    \parsep        -8pt
    \fontsize{12}{18}\selectfont
  }%
  \item[] \centering\scshape\bfseries}%
{\endlist}

% 'Handa mayaṁ...``
\newenvironment{leader}%
{\list{}{%
    \parskip 16pt%
    \topsep 2pt%
    \listparindent 0em%
    \itemindent    0pt%
    \leftmargin    0pt %\leaderIndent%
    \rightmargin   0pt%
    \parsep        -8pt
  }%
  \fontsize{12.5}{12}\selectfont
  \item[] \centering}%
{\endlist}

\newenvironment{leader-only}%
{\list{}{%
    \parskip 10pt%
    \topsep 2pt%
    \listparindent 0em%
    \itemindent    0pt%
    \leftmargin    0pt %\leaderIndent%
    \rightmargin   0pt%
    \parsep        0pt%
  }%
  \fontsize{12.5}{12}\selectfont
  \item[] \centering}%
{\endlist}

\newenvironment{leader-yatha}%
{\list{}{%
    \parskip 16pt%
    \topsep 0pt%
    \listparindent 0em%
    \itemindent    0pt%
    \leftmargin    0.5cm %\leaderIndent%
    % \leftmargin    4.0cm %\leaderIndent%
    \rightmargin   0.5cm%
    \parsep        \z@ \@plus\p@%
   }%
  \fontsize{12.5}{18}\selectfont
  \item[] \centering}%
{\endlist}

% Reduces above spacing for english leader when paired with a pali introduction
\newenvironment{leader-english-belowpali}%
{\list{}{%
    \parskip 6pt%
    \topsep 2pt%
    \listparindent 0em%
    \itemindent    0pt%
    \leftmargin    0pt %\leaderIndent%
    \rightmargin   0pt%
    \parsep        -8pt
    \fontsize{12}{14}\selectfont
  }%
  \item[] \centering\itshape}%
{\endlist}

% 'Now let us...'
\newenvironment{leader-english}%
{\list{}{%
    \parskip 16pt%
    \topsep 2pt%
    \listparindent 0em%
    \itemindent    0pt%
    \leftmargin    0pt %\leaderIndent%
    \rightmargin   0pt%
    \parsep        -8pt
    \fontsize{12}{14}\selectfont
  }%
  \item[] \centering\itshape}%
{\endlist}

\newenvironment{leader-english-yatha}%
{\list{}{%
    \parskip 0pt%
    \topsep 0pt%
    \listparindent 0em%
    \itemindent    0pt%
    \leftmargin    0pt %\leaderIndent%
    \rightmargin   0pt%
    % \parsep        -8pt
     \parsep        \z@ \@plus\p@%
    \fontsize{12}{18}\selectfont
  }%
  \item[] \centering\itshape}%
{\endlist}

\newcommand{\instr}[1]{%
  {\instrFmt #1}%
}

\newcommand{\instrSidepar}[1]{%
  \sidepar{\hspace*{-22mm}\parbox{25mm}{#1}}%
}

\newcommand{\soloinstr}[1]{%
  {\centering\instrFmt #1\par}%
}

% \newenvironment{paritta}%
% {\list{}{%
%     \topsep 0pt
%     \parskip 0pt
%     \partopsep 0pt
%     \listparindent 0em%
%     \itemindent    0em%
%     \leftmargin    1.5em% \leaderIndent, but keep it a separate value
%     \rightmargin   0em%
%     \parsep        7pt%
%   }%
%   \item[] \raggedright}%
% {\endlist}

% Used throughout the Verses chapter and other chants that are separated by a hyphen
 % \newenvironment{twochants}%
 % {\begin{tabular}{@{}l l@{}}
 %      \vspace{-0.2em}%
 %    }%
 %    {\end{tabular}}

 \newenvironment{verses}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    0em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12.5}{18}\selectfont
     \parsep        0em %\z@ \@plus\p@%
   }%
   \item[] \raggedright}%
 {\endlist}

% For English passages that are preceeded by Pāli, remains closer to the preceeding Pāli
 \newenvironment{english}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    1.0em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        -8.5em %\z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 % For chants like 'The Highest Blessings' which are English only and therefore don't need left margin indentation
 \newenvironment{english-only}%
 {\list{}{%
     % \parskip       8pt
     \topsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    0em%\leaderindent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     % \parsep        %\z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

% For chants like 'The Gradual Training' which are English only yet need to be justified
 \newenvironment{english-only-justify}%
 {\list{}{%
     % \parskip       8pt
     \topsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    0em%\leaderindent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     % \parsep        %\z@ \@plus\p@%
   }%
   \item[] \justify\itshape}%
 {\endlist}

 % For an English line that is too long to fit on one line and thus needs its continuation to be hang indented
 \newenvironment{english-hang}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    1.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        -8.5em %\z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

% Enables an English line to hang that is sandwiched within a paragraph
 \newenvironment{english-hangtogether}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    0.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
     \parskip       -16pt
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 % Wraps around the `english-hangtogether` environment to allow the middle hang indent to keep congruent spacing
 \newenvironment{english-keepwith}%
 {\list{}{%
     \topsep 0pt
     \partopsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    1em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

% For singular English lines that need hang indentation
 \newenvironment{english-only-hang}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    0.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 \newenvironment{english-only-hangtogether}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    0.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
     \parskip       -16pt
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

% Similar to keepwith, wraps around `english-hangtogether` but doesn't keep with previous paragraph
 \newenvironment{english-only-nohang}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    0em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

% Used with with Pāli verses and parittas
 \newenvironment{english-verses}%
 {\list{}{%
     \partopsep 0pt
     \topsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    1.0em%\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 \newenvironment{english-verses-bracket}%
 {\list{}{%
     \partopsep 0pt
     \topsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    2.0em%\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

% Used for TWO problematic line
 \newenvironment{english-hang-firstline}%
 {\list{}{%
     \partopsep 0pt
     \topsep 4pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    0.5em%\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 % For an English line that is too long to fit on one line and thus needs its continuation to be hang indented
 \newenvironment{english-hang-verses}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    1.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
     % \parsep        -8.5em %\z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 \newenvironment{english-hang-verses-brackets}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    2.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
     % \parsep        -8.5em %\z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 \newenvironment{english-hangtogether-verses}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    0.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
     \parskip       -16pt
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 \newenvironment{english-verses-keepwith}%
 {\list{}{%
     \topsep 0pt
     \partopsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    2.0em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 \newenvironment{cprenglish}%
 {\list{}{%
     \partopsep 0pt
     \topsep -10pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    \leaderIndent%
     \rightmargin   0em%
     % \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 \newenvironment{packedenglish}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    \packedLeaderIndent%
     \rightmargin   0em%
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright\itshape}%
 {\endlist}

 \newenvironment{pali-hang}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    0.5em %2.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12.5}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright}%
 {\endlist}

 \newenvironment{pali-hang-bracket}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    -0.75em%
     \leftmargin    0.75em %2.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12.5}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright}%
 {\endlist}

% Enables a line to hang that is sandwiched within a paragraph
 \newenvironment{pali-hangtogether}%
 {\list{}{%
     \topsep -8pt
     \listparindent 0em%
     \itemindent    -0.75em%
     \leftmargin    0.75em %2.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12.5}{18}\selectfont
     \parsep        -8pt %\z@ \@plus\p@%
   }%
   \item[] \raggedright}%
 {\endlist}

 \newenvironment{pali-hangtogether-bracket}%
 {\list{}{%
     \topsep -8pt
     \listparindent 0em%
     \itemindent    -1.0em%
     \leftmargin    1.0em %2.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12.5}{18}\selectfont
     \parsep        -8pt %\z@ \@plus\p@%
   }%
   \item[] \raggedright}%
 {\endlist}

 \newenvironment{pali-keepwith}%
 {\list{}{%
     \topsep 0pt
     \partopsep 0pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    0.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12.5}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright}%
 {\endlist}

 \newenvironment{pali-hang-continued}%
 {\list{}{%
     \topsep 0pt
     \listparindent 0em%
     \itemindent    0em%
     \leftmargin    0.5em %2.5em %\leaderIndent%
     \rightmargin   0em%
     \fontsize{12.5}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright}%
 {\endlist}

 \newenvironment{pali-hang-firstline}%
 {\list{}{%
     \partopsep 0pt
     \topsep 4pt
     \listparindent 0em%
     \itemindent    -0.5em%
     \leftmargin    0.5em%\leaderIndent%
     \rightmargin   0em%
     \fontsize{12.5}{18}\selectfont
     \parsep        \z@ \@plus\p@%
   }%
   \item[] \raggedright}%
 {\endlist}

%%%%%%%%%%%%%%%%%%% Endnotes %%%%%%%%%%%%%%%%%%%

% Changes the title for the Endnotes chapter
\renewcommand\notesname{Endnotes}

\renewcommand{\prenoteinnotes}{%
    \small\par\noindent%
    }%
\renewcommand{\noteidinnotes}[2]{% {notenum}{id}
    \begin{adjustwidth}{14pt}{0pt}%
        \hspace{-33pt}\makebox[30pt][l]{%
            \makebox[18pt][1]{\pageref{#2}}%
            \makebox[16pt][l]{\ifnum#1>0\textsuperscript{#1}\fi%
            }%
    }%
}%
\renewcommand{\pageinnotes}[1]{}%
\renewcommand{\postnotetext}{%
    \end{adjustwidth}%
}%
\renewcommand{\postnoteinnotes}{\par}%

% \usepackage{endnotes}
% \usepackage{ifthen}
% \usepackage{endheads} % requires oldfontcommands option for memoir class
%     \setupendnoteheaders
%     \titleinnotestrue  % title page
%     \setstyleforchapternotebegin{\begin{flushleft}\begin{bf}\normalsize}
%     \setstyleforchapternoteend{\end{bf}\end{flushleft}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand\tr[1]{\textit{#1}}

\newcommand\trline[1]{%
  \begin{english}%
    #1%
  \end{english}%
}

\newcommand\packedtrline[1]{%
  \begin{packedenglish}%
    #1%
  \end{packedenglish}%
}

\newlength\preceptnumwidth
\setlength{\preceptnumwidth}{\widthof{\normalsize 9.\space}}

\newenvironment{precept}%
{\begin{enumerate}[
         itemindent=0pt,
         leftmargin={\preceptnumwidth},
         rightmargin=0pt,
         ]%
         }{\end{enumerate}}

       \newcommand\hsp{\hspace*{0.5em}}

       % ==== Tabular ==== %

       \setlength{\tabcolsep}{1em}

       \renewcommand{\arraystretch}{1.075}

       \newcommand\oldArr{}% holding old \arraystretch for restore
       \let\oldArr\arraystretch

       \newcommand\setArrayStretch[1]{%
         \let\oldArr\arraystretch
         \renewcommand{\arraystretch}{#1}%
       }

       \newcommand\restoreArrayStretch{\let\arraystretch\oldArr}
